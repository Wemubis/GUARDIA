# README: Guardia-Pentest_Crypto

## Description
This project implements a secure voting system that allows:
- Users to register, log in, and vote for a candidate.
- Ensuring that a user can only vote once, even after logging out.
- Administrators to view the results through a dedicated interface.

The project uses cryptographic techniques to secure votes, including:
- **AES (Advanced Encryption Standard)** to encrypt votes.
- **RSA (Rivest–Shamir–Adleman)** to secure AES keys.
- **HMAC (Hash-based Message Authentication Code)** to ensure data integrity.

## Features
### 1. User
- **Registration**: Create an account with a username and password.
- **Login**: Authenticate users.
- **Vote**: A user can vote for a candidate, but only once.

### 2. Administrator
- **Default admin account**: `admin:admin`.
- **Access to results**: View results in a table listing each candidate and the number of votes received.

---

## Project Structure

### Backend: `app.py`
- **Language**: Python (Flask).
- **Main routes**:
  - `/register`: Registration.
  - `/login`: Login.
  - `/vote`: Submit a vote.
  - `/admin`: Admin page.
- **Key functions**:
  - `init_db`: Initialize the SQLite database with `users` and `votes` tables.
  - `vote`: Add a vote with AES + RSA encryption and check user rights.
  - `admin_page`: View results with decryption of the votes.

### Frontend
- **HTML Templates**:
  - `register.html`: Registration form.
  - `login.html`: Login form.
  - `vote.html`: User interface to vote.
  - `admin.html`: Results table for administrators.

---

## Installation

### Prerequisites
1. Python 3.8+
2. Virtualenv
3. SQLite3

### Steps
1. **Install dependencies**:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: .\venv\Scripts\activate.ps1
   pip install -r requirements.txt
   ```

2. **Start the server**:
   ```bash
   python app.py
   ```

---

## Database
### Main tables
1. **`users`**:
   - `username`: Unique username.
   - `password`: Hashed password.
   - `is_admin`: Admin status (0 or 1).

2. **`votes`**:
   - `id`: Unique vote identifier.
   - `username`: Username of the voter.
   - `encrypted_vote`: Vote encrypted with AES.
   - `encrypted_key`: AES key encrypted with RSA.
   - `hmac`: HMAC for integrity.
   - `iv`: AES initialization vector.

---

## Security
- **Secure hashing**: Using `werkzeug.security.generate_password_hash` for passwords.
- **Protection against SQL injection**: Bound parameters in all SQLite queries.
- **Input sanitization**: Using `markupsafe.escape` to prevent XSS attacks.
